<!doctype html>
<html>
<head>
    <!-- 设置当前HTML文件的字符编码 -->
    <meta charset="utf-8">
    <!-- 设置浏览器的兼容模式版本 （让IE使用最新的渲染引擎工作） -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 声明当前网页在移动端浏览器中展示的相关设置 -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
        ul {
           list-style-type: none;
           margin: 0;
           padding: 0;
        }
        li {
          display: inline-block;
        }
        .center{
           margin: 15px auto;
            width: 270px;
        }
        .center span{
           font-size: 16px;
        }
        .center.settings{
            width: 100px;
        }
        #searchStr{
            width: 190px;
            margin-right: 10px;
        }
        .package{
            min-width:95%;
            max-width:300px;
            width: 98%;
            height:60px;
            margin: 0 auto;
            border-bottom: 2px solid gray;
        }
        .pkg-label{
            font-size: 16px;
            margin: 5px 2px 5px;
        }
        .pkg-name{
            font-size: 12px;
            color: gray;
            margin: 0 5px 0;
        }
        .package li.isSelect{
            width: 20px;
            height: 60px;
            overflow: hidden;
        }
        .package li.isSelect input{
            position: relative; /*脱离文档流*/
            top: 35%; /*偏移*/
        }
        .package li.appInfo{
            margin-left: 5px;
            width: 250px;
            height: 60px;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div>
    <div class="center">
        <div class="settings center">
            <button id="settings-reset">重置</button>
            <button id="settings-save">保存</button>
        </div>
    </div>
    <div class="center">
        <input type="radio" name="mode" id="mode_0" value="0"><span>默认(全局)</span>
        <input type="radio" name="mode" id="mode_1" value="1"><span>白名单</span>
        <input type="radio" name="mode" id="mode_2" value="2"><span>黑名单</span>
    </div>
    <div class="center">
        <input type="text" id="searchStr">
        <button id="search">搜索</button>
    </div>
    <div id="package">
    <ul class="package ">
        <li class="isSelect ">
            <input type="checkbox" checked="checked"/>
        </li>
        <li class="appInfo ">
            <div><p class="pkg-label ">app名称</p></div>
            <div><p class="pkg-name " pkg="pkg">man.who.scan.my.app.die.a.mother</p></div>
        </li>
    </ul>
    <ul class="package ">
        <li class="isSelect ">
            <input type="checkbox" checked="checked"/>
        </li>
        <li class="appInfo ">
            <div><p class="pkg-label ">版本</p></div>
            <div><p class="pkg-name " pkg="pkg">man.who.scan.my.app.die.a.mother</p></div>
        </li>
    </ul>
    <ul class="package ">
        <li class="isSelect ">
            <input type="checkbox" checked="checked"/>
        </li>
        <li class="appInfo ">
            <div><p class="pkg-label ">版本</p></div>
            <div><p class="pkg-name " pkg="pkg">man.who.scan.my.app.die.a.mother</p></div>
        </li>
    </ul>
    </div>
</div>

</body>
</html>

<script type="text/javascript">
    var reload = function (){
        console.log('------------------reload');
        // 模式
        var mode = window.android.getAppMode();
        document.getElementById('mode_' + mode).checked = true;
        // 包信息
        var package = document.getElementById('package');
        var appListStr = window.android.getApplist();
        var appList = JSON.parse(appListStr);
        var html = "";
        appList.forEach((app) =>{
            var node = '<ul class="package "><li class="isSelect "><input type="checkbox" ';
            if( (mode == '1' && app.isInWhiteList) || (mode == '2' && app.isInBlackList) )
                node += 'checked="checked"'
            node += '/> </li><li class="appInfo "><div><p class="pkg-label ">';
            if(app.isSysApp)
                node += '*';
            node += app.appName;
            node += '</p></div><div><p class="pkg-name " pkg="pkg">';
            node += app.packageName;
            node += '</p></div></li></ul>';
            html += node;
        });
        package.innerHTML = html;
    }
    var save = function (){
        console.log('------------------save');
        var list = [];
        var mode = document.querySelector("input[name='mode']:checked").value;
        list.push(mode);
        document.querySelectorAll(".package").forEach((node)=>{
            if(node.querySelector("input").checked){
                list.push(node.querySelector(".pkg-name").innerText);
            }
        });
        window.android.setApplist(list.toString());
    }
    var btnReset = document.getElementById('settings-reset');
    var btnSave = document.getElementById('settings-save');
    var radioMode1 = document.getElementById('mode_1');
    var radioMode2 = document.getElementById('mode_2');
	btnReset.onclick = reload;
	btnSave.onclick = save;

	reload();

</script>
